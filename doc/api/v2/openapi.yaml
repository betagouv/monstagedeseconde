openapi: 3.0.0
info:
  title: API pour la création d'offres de stage sur https://1eleve1stage.education.gouv.fr/
  description: API pour la création d'offres de stages à destination des élèves de
    seconde générale et technologique
  contact:
    email: etienne.weil@monstagedetroisieme.fr
  version: 1.0.0
servers:
- url: http://localhost:3000/api
  description: SwaggerHub API Auto Mocking
security:
- bearerAuth: []
tags:
- name: developers
  description: Operations accessibles aux développeurs disposant d'une clé API. Celle-ci
    peut être fournie sur demande à l'adresse email contact @ 1eleve1stage.education.gouv.fr
paths:
  /internship_offers/{id}/internship_applications:
    get:
      tags:
      - developers
      summary: Récupère les candidatures pour une offre de stage donnée
      description: Récupère les candidatures pour une offre de stage identifiée par son ID
      operationId: get_internship_applications_for_internship_offer
      parameters:
      - name: id
        in: path
        description: Identifiant de l'offre de stage
        required: true
        style: simple
        explode: false
        schema:
          type: integer
          example: 1
      responses:
        "200":
          description: Liste des candidatures pour l'offre de stage
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/InternshipApplication'
      security:
      - bearerAuth: []
      x-swagger-router-controller: Developers
    post:
      tags:
      - developers
      summary: Permet à un élève de postuler à une offre de stage
      description: |
        Permet à un élève de postuler à une offre de stage en fournissant les informations
        nécessaires.
      operationId: create_internship_application
      parameters:
      - name: id
        in: path
        description: Identifiant de l'offre de stage
        required: true
        style: simple
        explode: false
        schema:
          type: integer
          example: 1
      requestBody:
        $ref: '#/components/requestBodies/InternshipApplication'
      responses:
        "201":
          description: Candidature créée avec succès
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternshipApplication'
      security:
        - bearerAuth: []
      x-swagger-router-controller: Developers
  /internship_offers:
    get:
      tags:
      - developers
      summary: liste (index) les offres déposées
      description: |
        Les offres retournées représentent l'ensemble des offres du site https://1eleve1stage.education.gouv.fr/ .
      operationId: internship_offers_index
      responses:
        "200":
          description: Offre de stage créée
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternshipOffers'
        "401":
          description: l'authentification a échoué
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/inline_response_401'
        "404":
          description: Un argument de la requête fait échouer la requête.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/inline_response_404_1'
      security:
      - bearerAuth: []
      x-swagger-router-controller: Developers
    post:
      tags:
      - developers
      summary: ajoute une offre de stage d'un partenaire aux offres proposées en propre
        par les équipes 1élève1stage
      description: |
        Les offres de stages décrits ci-dessous décrivent les offres réservées aux classes de **seconde générale et technologique**
      operationId: internship_offers
      requestBody:
        $ref: '#/components/requestBodies/InternshipOffer'
      responses:
        "201":
          description: Offre de stage créée
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternshipOffer'
        "401":
          description: l'authentification a échoué
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/inline_response_401'
        "403":
          description: L'utilisateur n'est pas autorisé à supprimer cette offre de
            stage
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/inline_response_403'
        "404":
          description: Un argument de la requête fait échouer la requête.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/inline_response_404'
        "406":
          description: Un ou plusieurs paramètres de requête sont invalides
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/inline_response_406'
        "409":
          description: Conflit. Une offre de stage avec le même remote_id existe déjà
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/inline_response_409'
        "422":
          description: Un argument au moins de la requête fait échouer la requête
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/inline_response_422'
      security:
        - bearerAuth: []
      x-swagger-router-controller: Developers
  /internship_offers/{remote_id}:
    delete:
      tags:
      - developers
      summary: Supprime une offre de stage d'un partenaire des offres proposées sur
        le site https://1eleve1stage.education.gouv.fr/
      description: |
        Suppression des offres
      operationId: internship_offers_delete
      parameters:
      - name: remote_id
        in: path
        description: id de l'offre de stage
        required: true
        style: simple
        explode: false
        schema:
          type: string
          example: remote-123
      responses:
        "200":
          description: Offre de stage supprimée
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternshipOffer'
        "401":
          description: l'authentification a échoué
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/inline_response_401'
        "403":
          description: L'utilisateur n'est pas autorisé à supprimer cette offre de
            stage
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/inline_response_403'
        "404":
          description: Un argument de la requête fait échouer la requête.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/inline_response_404'
        "422":
          description: Un argument de la requête fait échouer la requête.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/inline_response_422'
      security:
      - bearerAuth: []
      x-swagger-router-controller: Developers
    patch:
      tags:
      - developers
      summary: met à jour une offre de stage d'un partenaire aux offres proposées
        en propre par les équipes 1élève1stage
      description: |
        Mise à jour des offres . Possibilité de désactiver son offre en passant le paramètre published_at à null
      operationId: internship_offers_updatte
      parameters:
      - name: remote_id
        in: path
        description: "clé étrangère unique , id de l'offre de stage chez le partenaire"
        required: true
        style: simple
        explode: false
        schema:
          type: string
          example: remote-123
      requestBody:
        $ref: '#/components/requestBodies/InternshipOfferPatch'
      responses:
        "200":
          description: Offre de stage mise à jour
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternshipOffer'
        "401":
          description: l'authentification a échoué
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/inline_response_401'
        "403":
          description: L'utilisateur n'est pas autorisé à supprimer cette offre de
            stage
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/inline_response_403'
        "404":
          description: Un argument de la requête fait échouer la requête.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/inline_response_404'
        "406":
          description: Un ou plusieurs paramètres de requête sont invalides
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/inline_response_406'
        "422":
          description: Un argument au moins de la requête fait échouer la requête
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/inline_response_422'
      security:
      - bearerAuth: []
      x-swagger-router-controller: Developers
  /internship_offers/search:
    get:
      tags:
        - developers
      summary: Recherche des offres de stage
      description: Recherche des offres de stage déposées par le partenaire.

      parameters:
        - in: query
          name: latitude
          schema:
            type: number
          required: false
          example: 48.8566
        - in: query
          name: longitude
          schema:
            type: number
          required: false
          example: 2.3522
        - in: query
          name: radius
          schema:
            type: integer
          required: false
          example: 40000
        - in: query
          name: keyword
          schema:
            type: string
          required: false
          example: "Game designer"

      responses:
        '200':
          description: Offres de stages du partenaire
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InternshipOffers'
      security:
      - bearerAuth: []
      x-swagger-router-controller: Developers
  /sectors:
    get:
      tags:
      - developers
      summary: Récupère la liste des secteurs économiques
      description: "Secteur économique. Voir la liste complète ici : [https://github.com/betagouv/monstagedeseconde/blob/staging/doc/README.md#secteurs-dactivité\
        ](https://github.com/betagouv/monstagedeseconde/blob/staging/doc/README.md#secteurs-dactivité\
        )"
      operationId: sectors
      responses:
        "200":
          description: Liste des secteurs économiques
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Sector'
                x-content-type: application/json
      security:
      - bearerAuth: []
      x-swagger-router-controller: Developers
  /students/{student_id}/internship_applications:
    get:
      tags:
      - developers
      summary: Récupère les candidatures d'un élève
      description: Récupère les candidatures d'un élève identifié par son UUID
      operationId: get_internship_applications_for_student
      parameters:
      - name: student_id
        in: path
        description: id de l'élève
        required: true
        style: simple
        explode: false
        schema:
          type: integer
          example: 1
      responses:
        "200":
          description: Liste des candidatures de l'élève
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/InternshipApplication'
      security:
      - bearerAuth: []
      x-swagger-router-controller: Developers
components:
  schemas:
    InternshipApplication:
      type: object
      properties:
        id:
          type: integer
          example: 1
        uuid:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        user_id:
          type: integer
          example: 1
        aasm_state:
          type: string
          example: "submitted"
          maxLength: 100
        submitted_at:
          type: string
          format: date-time
          example: "2023-03-15T10:00:00Z"
        student_email:
          type: string
          format: email
          maxLength: 100
          example: jean.dupont@example.com
        student_address:
          type: string
          maxLength: 300
          example: 12 rue de la paix, 75001 Paris
        student_phone:
          type: string
          maxLength: 20
          example: "+330612345678"
        internship_offer_id:
          type: integer
          example: 1
        motivation:
          type: string
          maxLength: 1500
          example: Je souhaite faire ce stage pour découvrir le métier de développeur
        student_legal_representative_full_name:
          type: string
          maxLength: 150
          example: Jean Dupont
        student_legal_representative_email:
          type: string
          format: email
          maxLength: 109
          example: jean.dupont@example.com
        student_legal_representative_phone:
          type: string
          maxLength: 50
          example: "+330612345678"
        week_ids:
          type: array
          items:
            $ref: '#/components/schemas/Week'
          description: Liste des identifiants des semaines pour lesquelles l'élève postule
          example:
            - 2023-W9
            - 2023-W10
      description: Candidature à une offre de stage
    InternshipOffers:
      type: array
      items:
        $ref: '#/components/schemas/InternshipOffer'
    InternshipOffer:
      required:
      - city
      - coordinates
      - employer_name
      - is_public
      - max_candidates
      - period
      - remote_id
      - sector_uuid
      - street
      - title
      - grades
      - weeks
      - qpv
      - rep
      type: object
      properties:
        remote_id:
          type: string
          maxLength: 60
          description: Identifiant de l'offre de stage chez le partenaire
          example: A156548-H
        description:
          maxLength: 500
          type: string
          description: Description de l'offre de stage
        title:
          type: string
          maxLength: 150
          example: Stage d'observation du métier de chef de service
        employer_name:
          type: string
          maxLength: 150
          example: BNP Paribas
        employer_description:
          maxLength: 275
          type: string
          example: "Créateur de lotions, de parfums et de produits cosmétiques, embaumeur"
        street:
          type: string
          maxLength: 500
          example: 16 rue de la paix
        city:
          type: string
          maxLength: 50
          example: Paris
        zipcode:
          type: string
          maxLength: 5
          example: "75001"
        employer_website:
          type: string
          maxLength: 560
          example: http://www.acnee-corporation.fr
        lunch_break:
          type: string
          maxLength: 500
          description: Horaires de pause déjeuner
          example: 12h-14h
        daily_hours:
          $ref: '#/components/schemas/InternshipOffer_daily_hours'
        coordinates:
          $ref: '#/components/schemas/InternshipOffer_coordinates'
        grades:
          type: array
          description: Liste des classes dont les élèves peuvent postuler à l'offre de stage
          items:
            $ref: '#/components/schemas/Grade'
        permalink:
          type: string
          description: Site de l'employeur
          maxLength: 200
          example: http://www.stagechezemployeur.fr
        max_candidates:
          type: integer
          description: Nombre maximum de candidats pouvant postuler à cette offre
            de stage sur l'ensemble des semaines proposées
          example: 1
        is_public:
          type: boolean
          description: "true si l'offre de stage est issue d'une administration publique,\
            \ false si elle est issue d'une entreprise privée"
          example: true
        sector_uuid:
          $ref: '#/components/schemas/Sector'
        rep:
          type: boolean
          description: "true si l'offre de stage est réservée à des collèges en rep ou rep plus"
          example: true
        qpv:
          type: boolean
          description: "true si l'offre de stage est réservée à des établissements en qpv"
          example: true
        weeks:
          type: array
          items:
            type: string
            format: <annee_scolaire>-W<no_de_semaine>
          description: Liste des semaines pendant lesquelles l'offre de stage est disponible
          example:
            - 2023-W12
            - 2023-W13
      description: offre de stage
      example:
        remote_id: A123-12
        grade: ['seconde', 'troisieme']
        city: Paris
        coordinates:
          latitude: 48.866667
          longitude: 2.333333
        description: Stage sur le thème de la logistique et de la supply chain
        employer_description: "Créateur de lotions, de parfums et de produits cosmé\
          tiques, embaumeur"
        employer_name: BNP Paribas
        title: Stage d'observation du métier de chef de service
        lunch_break: 12h-14h
        zipcode: "75001"
        max_candidates: 1
        employer_website: http://www.acnee-corporation.fr
        sector_uuid:
          sector_uuid: s20
          name: Mode
          id: 1
        street: 16 rue de la paix
        is_public: true
        rep: false
        qpv: true
        weeks:
          - 2023-W12
          - 2023-W13
        permalink: http://www.stagechezemployeur.fr
        daily_hours:
          type: object
          description: Horaires de stage
          properties:
            lundi:
              type: array
              items:
                type: string
              example:
              - "9:00"
              - "18:00"
            mardi:
              type: array
              items:
                type: string
              example:
              - "9:00"
              - "18:00"
            mercredi:
              type: array
              items:
                type: string
              example:
              - "9:00"
              - "18:00"
            jeudi:
              type: array
              items:
                type: string
              example:
              - "9:00"
              - "18:00"
            vendredi:
              type: array
              items:
                type: string
              example:
              - "9:00"
              - "18:00"
    InternshipOfferPatch:
      allOf:
      - type: object
        properties:
          published_at:
            type: string
            format: date-time
      - $ref: '#/components/schemas/InternshipOffer'
      description: Offre de stage à mettre à jour. Pour désactiver une offre, passer le paramètre published_at à null
    Grade:
      type: string
      enum:
        - seconde
        - troisieme
        - quatrieme
      example:
        - seconde
    Sector:
      type: object
      properties:
        id:
          type: number
          example: 1
        sector_uuid:
          type: string
          format: uuid
        name:
          type: string
          example: Mode
      description: Secteur économique.
      example:
        sector_uuid: s20
        name: Mode
        id: 1
    inline_response_401:
      type: object
      properties:
        code:
          type: string
          example: UNAUTHORIZED
        error:
          type: string
          example: access denied
        status:
          type: string
          example: unauthorized
    inline_response_403:
      type: object
      properties:
        code:
          type: string
          example: FORBIDDEN
        error:
          type: string
          example: access denied
        status:
          type: string
          example: forbidden
    inline_response_404:
      type: object
      properties:
        code:
          type: string
          example: NOT_FOUND
        error:
          type: string
          example: can't find internship_offer with this remote_id
        status:
          type: string
          example: not_found
    inline_response_406:
      type: object
      properties:
        code:
          type: string
          example: VALIDATION_ERROR
        error:
          type: string
          example: Erreur de validation sur l'objet
        status:
          type: string
          example: conflict
    inline_response_409:
      type: object
      properties:
        code:
          type: string
          example: DUPLICATE_WEEKY_FRAMED
        error:
          type: string
          example: period with this remote_id ("A123-2") already exists.
        status:
          type: string
          example: conflict
    inline_response_422:
      type: object
      properties:
        code:
          type: string
          example: BAD_ARGUMENT
        error:
          type: string
          example: Erreur sur la requête due à un un paramètre invalide
        status:
          type: string
          example: unprocessable_entity
    inline_response_404_1:
      type: object
      properties:
        code:
          type: string
          example: NOT_FOUND
        error:
          type: string
          example: can't find internship_offer with this remote_id
        status:
          type: string
          example: not_found
    inline_response_429:
      type: object
      properties:
        code:
          type: string
          example: TOO_MANY_REQUESTS
        error:
          type: string
          example: request limit exceeded (100 per minutes)
        status:
          type: string
          example: too_many_requests
    InternshipOffer_coordinates:
      type: object
      properties:
        latitude:
          type: number
          example: 48.866667
        longitude:
          type: number
          example: 2.333333
      description: Coordonnées géographiques du lieu de stage
    InternshipOffer_daily_hours:
      type: object
      properties:
        lundi:
          type: array
          example:
            - "9:00"
            - "18:00"
          items:
            type: string
        mardi:
          type: array
          example:
            - "9:00"
            - "18:00"
          items:
            type: string
        mercredi:
          type: array
          example:
            - "9:00"
            - "18:00"
          items:
            type: string
        jeudi:
          type: array
          example:
            - "9:00"
            - "18:00"
          items:
            type: string
        vendredi:
          type: array
          example:
            - "9:00"
            - "18:00"
          items:
            type: string
      description: Horaires quotidiens de stage
    Week:
      properties:
        type: string
        format: <annee_scolaire>-W<no_de_semaine>
        example: 2023-W12
      items:
        type: string
      description: Semaine pendant laquelle l'offre de stage est disponible
  responses:
    Unauthorized:
      description: l'authentification a échoué
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/inline_response_401'
  requestBodies:
    InternshipOffer:
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/InternshipOffer'
    InternshipOfferPatch:
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/InternshipOfferPatch'
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
